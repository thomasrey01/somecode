(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"/zN5":function(t,e,i){"use strict";i.r(e),i.d(e,"AttendencePageModule",(function(){return U}));var n=i("PCNd"),o=i("iInd"),a=i("sjEL"),c=i("LRne"),r=i("JX91"),s=i("pLZG"),b=i("vkgz"),l=i("eIep"),d=i("lJxs"),m=i("IzEk"),p=i("tS1D"),u=i("JIr8"),h=i("zp1y"),g=i("C/rb"),f=i("s7LF"),O=i("p6Ya"),P=i("7bNT"),v=i("381a"),k=i("PgGQ"),y=i("bMRy"),I=i("yg+Z"),z=i("3kdJ"),w=i("uxKI"),$=i("8Y7J"),x=i("tqRt"),C=i("63OA"),j=i("TSSN"),M=i("cUpR"),A=i("sZkV"),B=i("SVse"),N=i("Xnh/");function R(t,e){if(1&t&&$.Lb(0,"img",7),2&t){const t=$.Zb();$.hc("src",t.getProfilePicUrl(t.participation),$.qc)}}function D(t,e){if(1&t&&($.Pb(0,"div",8),$.vc(1),$.Ob()),2&t){const t=$.Zb();$.zb(1),$.xc(" ",t.getInitials(null==t.participation.member?null:t.participation.member.firstName,null==t.participation.member?null:t.participation.member.lastName)," ")}}let L=(()=>{class t{constructor(t){this.sanitizer=t,this.buttonText="bookingModule.attending",this.onAttendanceClicked=new $.n}ngOnInit(){}getProfilePicUrl(t){var e,i,n;return(null===(e=t.member)||void 0===e?void 0:e.picture)?this.sanitizer.bypassSecurityTrustResourceUrl("data:image/jpeg;base64,"+(null===(n=null===(i=t.member)||void 0===i?void 0:i.picture)||void 0===n?void 0:n.baseEncodedPhoto)):null}getInitials(t,e){return t||e?(null==t?void 0:t.charAt(0))+(null==e?void 0:e.charAt(0)):""}onClickRow(t){this.onAttendanceClicked.emit(t)}}return t.\u0275fac=function(e){return new(e||t)($.Kb(M.b))},t.\u0275cmp=$.Eb({type:t,selectors:[["attendance-row"]],inputs:{participation:"participation",buttonText:"buttonText"},outputs:{onAttendanceClicked:"onAttendanceClicked"},decls:12,vars:7,consts:[[1,"participants-list-row"],["size","3",1,"ion-justify-self-start"],["class","product-img",3,"src",4,"ngIf"],["class","initials-box",4,"ngIf"],["size","5",1,"ion-text-left"],["size","4",1,"ion-text-right",2,"padding","0"],["size","small","color","primary",1,"attend-button",3,"click"],[1,"product-img",3,"src"],[1,"initials-box"]],template:function(t,e){1&t&&($.Pb(0,"ion-grid"),$.Pb(1,"ion-row",0),$.Pb(2,"ion-col",1),$.tc(3,R,1,1,"img",2),$.tc(4,D,2,1,"div",3),$.Ob(),$.Pb(5,"ion-col",4),$.Pb(6,"ion-text"),$.vc(7),$.Ob(),$.Ob(),$.Pb(8,"ion-col",5),$.Pb(9,"ion-button",6),$.Xb("click",(function(){return e.onClickRow(e.participation)})),$.vc(10),$.ac(11,"translate"),$.Ob(),$.Ob(),$.Ob(),$.Ob()),2&t&&($.zb(3),$.hc("ngIf",e.getProfilePicUrl(e.participation)),$.zb(1),$.hc("ngIf",!e.getProfilePicUrl(e.participation)),$.zb(3),$.yc(" ",null==e.participation.member?null:e.participation.member.firstName," ",null==e.participation.member?null:e.participation.member.lastName," "),$.zb(3),$.xc(" ",$.bc(11,5,e.buttonText)," "))},directives:[A.w,A.P,A.q,B.o,A.bb,A.h],pipes:[j.c],styles:[".participants-list-row[_ngcontent-%COMP%]{display:flex;align-items:center}.attend-button[_ngcontent-%COMP%]{font-size:clamp(.5rem,3vw,.7rem);max-width:100%;white-space:inherit;word-wrap:break-word}.initials-box[_ngcontent-%COMP%]{width:100%;min-height:50px;max-height:100px;font-size:1.4rem;display:flex;align-items:center;justify-content:center;color:#377dff;background-color:rgba(55,125,255,.1)}.initials-box[_ngcontent-%COMP%], .product-img[_ngcontent-%COMP%]{border-radius:5px}"]}),t})();var S=i("oVnf"),T=i("DVhg");function Z(t,e){1&t&&($.Pb(0,"div",5),$.Lb(1,"ion-spinner",6),$.Ob())}function q(t,e){1&t&&($.Pb(0,"ion-row"),$.Pb(1,"ion-col"),$.Pb(2,"div",20),$.Lb(3,"ion-spinner"),$.Ob(),$.Ob(),$.Ob())}function F(t,e){if(1&t){const t=$.Qb();$.Pb(0,"ion-item"),$.Pb(1,"attendance-row",25),$.Xb("onAttendanceClicked",(function(e){return $.oc(t),$.Zb(3).onClickDidAttend(e)})),$.Ob(),$.Ob()}if(2&t){const t=e.$implicit;$.zb(1),$.hc("participation",t)}}function X(t,e){if(1&t){const t=$.Qb();$.Pb(0,"ion-item"),$.Pb(1,"attendance-row",26),$.Xb("onAttendanceClicked",(function(e){return $.oc(t),$.Zb(3).onClickDidNotAttend(e)})),$.Ob(),$.Ob()}if(2&t){const t=e.$implicit;$.zb(1),$.hc("participation",t)("buttonText","bookingModule.cancelAttendance")}}function E(t,e){if(1&t&&($.Pb(0,"div",21),$.Pb(1,"ion-list",22),$.ac(2,"async"),$.Pb(3,"ion-list-header"),$.Pb(4,"h4"),$.vc(5),$.ac(6,"translate"),$.Ob(),$.Ob(),$.tc(7,F,2,1,"ion-item",23),$.ac(8,"async"),$.Ob(),$.Pb(9,"ion-list",24),$.ac(10,"async"),$.Pb(11,"ion-list-header"),$.Pb(12,"h4"),$.vc(13),$.ac(14,"translate"),$.Ob(),$.Ob(),$.tc(15,X,2,2,"ion-item",23),$.ac(16,"async"),$.Ob(),$.Ob()),2&t){const t=$.Zb(2);$.zb(1),$.hc("hidden",0===$.bc(2,6,t.unattendingParticipations$).length),$.zb(4),$.wc($.bc(6,8,"general.pending")),$.zb(2),$.hc("ngForOf",$.bc(8,10,t.unattendingParticipations$)),$.zb(2),$.hc("hidden",0===$.bc(10,12,t.attendingParticipations$).length),$.zb(4),$.wc($.bc(14,14,"bookingModule.attending")),$.zb(2),$.hc("ngForOf",$.bc(16,16,t.attendingParticipations$))}}function K(t,e){if(1&t){const t=$.Qb();$.Pb(0,"div",7),$.Pb(1,"ion-refresher",8),$.Xb("ionRefresh",(function(e){return $.oc(t),$.Zb().doRefresh(e)})),$.Lb(2,"ion-refresher-content"),$.Ob(),$.Pb(3,"ion-row"),$.Pb(4,"ion-col",9),$.Pb(5,"h4",10),$.vc(6),$.ac(7,"stripHtmlTags"),$.ac(8,"async"),$.ac(9,"getTranslation"),$.ac(10,"async"),$.Ob(),$.Ob(),$.Pb(11,"ion-col",11),$.Pb(12,"ion-button",12),$.Xb("click",(function(){return $.oc(t),$.Zb().onClickAllDidAttend()})),$.vc(13),$.ac(14,"translate"),$.Ob(),$.Ob(),$.Ob(),$.tc(15,q,4,0,"ion-row",13),$.ac(16,"async"),$.tc(17,E,17,18,"div",14),$.ac(18,"async"),$.Pb(19,"ion-card"),$.Pb(20,"ion-card-header"),$.Pb(21,"ion-card-title"),$.Pb(22,"h4"),$.vc(23),$.ac(24,"translate"),$.Ob(),$.Ob(),$.Ob(),$.Pb(25,"ion-card-content"),$.Pb(26,"form",15),$.Xb("ngSubmit",(function(){return $.oc(t),$.Zb().onSubmitForm()})),$.Pb(27,"ion-row",16),$.Pb(28,"ion-col",17),$.Pb(29,"ion-item"),$.Lb(30,"ion-input",18),$.Ob(),$.Ob(),$.Pb(31,"ion-col",17),$.Pb(32,"ion-button",19),$.vc(33),$.ac(34,"translate"),$.Ob(),$.Ob(),$.Ob(),$.Ob(),$.Ob(),$.Ob(),$.Ob()}if(2&t){const t=e.ngIf,n=$.Zb();var i;$.zb(6),$.xc(" ",$.bc(7,9,$.bc(8,11,$.dc(9,13,null==(i=$.bc(10,17,n.booking$))?null:i.linkedProductId,"product","description")))," "),$.zb(7),$.xc(" ",$.bc(14,19,"bookingModule.allDidAttend")," "),$.zb(2),$.hc("ngIf",$.bc(16,21,n.isLoading$)&&!n.isRefreshing),$.zb(2),$.hc("ngIf",!$.bc(18,23,n.isLoading$)),$.zb(6),$.wc($.bc(24,25,"bookingModule.totalMembersOnline")),$.zb(3),$.hc("formGroup",n.form)("patchForm",t),$.zb(6),$.hc("disabled",!n.form.valid),$.zb(1),$.xc(" ",$.bc(34,27,"general.submit")," ")}}const J=[{path:"",component:(()=>{class t{constructor(t,e,i,n,o,a){this.store=t,this.fb=e,this.notificationService=i,this.translate=n,this.sanitizer=o,this.actions$=a,this.isRefreshing=!1}ionViewDidEnter(){this.store.dispatch(z.a.resetState()),this.isLoading$=this.store.select(w.a.selectIsLoading).pipe(Object(r.a)(!1)),this.bookingIdParam$=this.store.select(I.a.selectIdRouteParam),this.booking$=this.bookingIdParam$.pipe(Object(s.a)(t=>Boolean(t)),Object(b.a)(t=>{this.store.dispatch(y.a.fetchOneById({id:t})),this.store.dispatch(z.a.fetchManyByBookingId({bookingId:t,params:O.RequestQueryBuilder.create({join:[{field:"member"},{field:"member.picture"},{field:"member.documents"}]})}))}),Object(l.a)(t=>this.store.select(I.a.selectById,t))),this.bookingParticipations$=this.bookingIdParam$.pipe(Object(l.a)(t=>this.store.select(w.a.selectByFilter,{field:"bookingId",value:t}))),this.unattendingParticipations$=this.bookingParticipations$.pipe(Object(d.a)(t=>t.filter(t=>!t.attended).sort((t,e)=>{var i,n,o,a;const c=`${null===(i=null==t?void 0:t.member)||void 0===i?void 0:i.firstName} ${null===(n=null==t?void 0:t.member)||void 0===n?void 0:n.lastName}`.toLowerCase(),r=`${null===(o=null==e?void 0:e.member)||void 0===o?void 0:o.firstName} ${null===(a=null==e?void 0:e.member)||void 0===a?void 0:a.lastName}`.toLowerCase();return null==c?void 0:c.localeCompare(r)}))),this.attendingParticipations$=this.bookingParticipations$.pipe(Object(d.a)(t=>t.filter(t=>t.attended).sort((t,e)=>{var i,n,o,a;const c=`${null===(i=null==t?void 0:t.member)||void 0===i?void 0:i.firstName} ${null===(n=null==t?void 0:t.member)||void 0===n?void 0:n.lastName}`.toLowerCase(),r=`${null===(o=null==e?void 0:e.member)||void 0===o?void 0:o.firstName} ${null===(a=null==e?void 0:e.member)||void 0===a?void 0:a.lastName}`.toLowerCase();return null==c?void 0:c.localeCompare(r)})))}ngOnInit(){this.form=this.fb.group({totalMembersOnline:["",[f.r.required]]})}onClickDidAttend(t){this.translate.get("bookingModule.attending").pipe(Object(m.a)(1)).subscribe(e=>{this.notificationService.emit(`${e} - ${t.member.firstName} ${t.member.lastName}`,"primary")}),this.store.dispatch(k.a({taskRequest:{type:v.a.accessControlRequestEntryByBooking,isAsync:!1,params:{bookingId:t.bookingId,memberId:t.memberId}}})),this.actions$.pipe(Object(P.d)(k.e),Object(p.a)(5e3),Object(u.a)(t=>Object(c.a)(null))).subscribe(e=>{e&&this.store.dispatch(z.a.fetchOneById({id:t.id,params:O.RequestQueryBuilder.create({join:[{field:"member"},{field:"member.picture"},{field:"member.documents"}]})}))}),this.bookingIdParam$.pipe(Object(l.a)(t=>this.store.select(I.a.selectById,t)),Object(m.a)(1)).subscribe(t=>{t.attendenceCheckedBy||this.store.select(g.a.selectMember).pipe(Object(m.a)(1)).subscribe(e=>{this.store.dispatch(y.a.updateOneById({id:t.id,params:{attendenceCheckedBy:+e.id,startDate:a(t.startDate),endDate:a(t.endDate)}}))})})}onClickAllDidAttend(){return this.unattendingParticipations$.pipe(Object(m.a)(1)).subscribe(t=>t.forEach((t,e)=>{setTimeout(()=>this.onClickDidAttend(t),1500*e)}))}onClickDidNotAttend(t){return this.store.dispatch(z.a.updateOneById({id:t.id,params:Object.assign(Object.assign({},t),{attended:!1})}))}onSubmitForm(){this.bookingIdParam$.pipe(Object(l.a)(t=>this.store.select(I.a.selectById,t)),Object(h.a)(this.store.select(g.a.selectMember)),Object(m.a)(1)).subscribe(([t,e])=>{this.store.dispatch(y.a.updateOneById({id:t.id,params:{totalMembersOnline:this.form.controls.totalMembersOnline.value,attendenceCheckedBy:e.id,startDate:a(t.startDate),endDate:a(t.endDate)}}))})}doRefresh(t){this.isRefreshing=!0,this.store.dispatch(z.a.resetState()),this.booking$.pipe(Object(m.a)(1)).subscribe(t=>{this.store.dispatch(z.a.fetchManyByBookingId({bookingId:t.id,params:O.RequestQueryBuilder.create({join:[{field:"member"},{field:"member.picture"},{field:"member.documents"}]})}))}),this.actions$.pipe(Object(P.d)(z.a.upsertMany),Object(p.a)(5e3),Object(u.a)(e=>(t.target.complete(),this.isRefreshing=!1,Object(c.a)(null)))).subscribe(e=>{this.isRefreshing=!1,t.target.complete()})}ngOnDestroy(){}}return t.\u0275fac=function(e){return new(e||t)($.Kb(x.h),$.Kb(f.c),$.Kb(C.a),$.Kb(j.d),$.Kb(M.b),$.Kb(P.a))},t.\u0275cmp=$.Eb({type:t,selectors:[["booking-attendence"]],decls:13,vars:13,consts:[["slot","start"],["defaultHref","/home/myhome/index/my-classes",3,"text"],[3,"fullscreen"],["class","ion-padding",4,"ngIf"],["class","main-content",4,"ngIf"],[1,"ion-padding"],[1,"ion-margin-horizontal"],[1,"main-content"],["slot","fixed",3,"ionRefresh"],["size","7"],[1,"ion-margin-start"],["size","5"],["color","primary","size","small",1,"ion-margin-top","ion-margin-end","all-did-attend-button","item-text-wrap",3,"click"],[4,"ngIf"],["class","list-container",4,"ngIf"],[3,"formGroup","patchForm","ngSubmit"],[1,"ion-margin-top"],["size","6"],["formControlName","totalMembersOnline","type","number","placeholder","0"],["expand","block","type","submit",3,"disabled"],[1,"ion-text-center"],[1,"list-container"],[3,"hidden"],[4,"ngFor","ngForOf"],[1,"ion-margin-top",3,"hidden"],[2,"width","100%",3,"participation","onAttendanceClicked"],[2,"width","100%",3,"participation","buttonText","onAttendanceClicked"]],template:function(t,e){1&t&&($.Pb(0,"ion-header"),$.Pb(1,"ion-toolbar"),$.Pb(2,"ion-buttons",0),$.Lb(3,"ion-back-button",1),$.Ob(),$.Pb(4,"ion-title"),$.vc(5),$.ac(6,"translate"),$.Ob(),$.Ob(),$.Ob(),$.Pb(7,"ion-content",2),$.tc(8,Z,2,0,"div",3),$.ac(9,"async"),$.ac(10,"async"),$.tc(11,K,35,29,"div",4),$.ac(12,"async"),$.Ob()),2&t&&($.zb(3),$.hc("text",""),$.zb(2),$.xc(" ",$.bc(6,5,"bookingModule.attendence")," "),$.zb(2),$.hc("fullscreen",!0),$.zb(1),$.hc("ngIf",!$.bc(9,7,e.booking$)||$.bc(10,9,e.isLoading$)),$.zb(3),$.hc("ngIf",$.bc(12,11,e.booking$)))},directives:[A.x,A.gb,A.i,A.e,A.f,A.eb,A.r,B.o,A.X,A.M,A.N,A.P,A.q,A.h,A.j,A.l,A.n,A.k,f.s,f.n,f.g,N.a,A.D,A.C,A.mb,f.m,f.e,A.H,A.I,B.n,L],pipes:[j.c,B.b,S.a,T.a],styles:[".all-did-attend-button[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;white-space:inherit}"]}),t})()}];let Q=(()=>{class t{}return t.\u0275mod=$.Ib({type:t}),t.\u0275inj=$.Hb({factory:function(e){return new(e||t)},imports:[[o.m.forChild(J)],o.m]}),t})(),U=(()=>{class t{}return t.\u0275mod=$.Ib({type:t}),t.\u0275inj=$.Hb({factory:function(e){return new(e||t)},providers:[],imports:[[Q,n.a]]}),t})()}}]);