!function(){function t(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,o,a=[],r=!0,c=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(a.push(i.value),!e||a.length!==e);r=!0);}catch(s){c=!0,o=s}finally{try{r||null==n.return||n.return()}finally{if(c)throw o}}return a}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return e(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"/zN5":function(e,i,a){"use strict";a.r(i),a.d(i,"AttendencePageModule",(function(){return tt}));var r=a("PCNd"),c=a("iInd"),s=a("sjEL"),b=a("LRne"),l=a("JX91"),d=a("pLZG"),u=a("vkgz"),f=a("eIep"),p=a("lJxs"),m=a("IzEk"),h=a("tS1D"),g=a("JIr8"),v=a("zp1y"),O=a("C/rb"),y=a("s7LF"),P=a("p6Ya"),k=a("7bNT"),I=a("381a"),w=a("PgGQ"),z=a("bMRy"),j=a("yg+Z"),C=a("3kdJ"),x=a("uxKI"),A=a("8Y7J"),$=a("tqRt"),M=a("63OA"),B=a("TSSN"),N=a("cUpR"),R=a("sZkV"),D=a("SVse"),L=a("Xnh/");function S(t,e){if(1&t&&A.Lb(0,"img",7),2&t){var n=A.Zb();A.hc("src",n.getProfilePicUrl(n.participation),A.qc)}}function T(t,e){if(1&t&&(A.Pb(0,"div",8),A.vc(1),A.Ob()),2&t){var n=A.Zb();A.zb(1),A.xc(" ",n.getInitials(null==n.participation.member?null:n.participation.member.firstName,null==n.participation.member?null:n.participation.member.lastName)," ")}}var Z,q=((Z=function(){function t(e){n(this,t),this.sanitizer=e,this.buttonText="bookingModule.attending",this.onAttendanceClicked=new A.n}return o(t,[{key:"ngOnInit",value:function(){}},{key:"getProfilePicUrl",value:function(t){var e,n,i;return(null===(e=t.member)||void 0===e?void 0:e.picture)?this.sanitizer.bypassSecurityTrustResourceUrl("data:image/jpeg;base64,"+(null===(i=null===(n=t.member)||void 0===n?void 0:n.picture)||void 0===i?void 0:i.baseEncodedPhoto)):null}},{key:"getInitials",value:function(t,e){return t||e?(null==t?void 0:t.charAt(0))+(null==e?void 0:e.charAt(0)):""}},{key:"onClickRow",value:function(t){this.onAttendanceClicked.emit(t)}}]),t}()).\u0275fac=function(t){return new(t||Z)(A.Kb(N.b))},Z.\u0275cmp=A.Eb({type:Z,selectors:[["attendance-row"]],inputs:{participation:"participation",buttonText:"buttonText"},outputs:{onAttendanceClicked:"onAttendanceClicked"},decls:12,vars:7,consts:[[1,"participants-list-row"],["size","3",1,"ion-justify-self-start"],["class","product-img",3,"src",4,"ngIf"],["class","initials-box",4,"ngIf"],["size","5",1,"ion-text-left"],["size","4",1,"ion-text-right",2,"padding","0"],["size","small","color","primary",1,"attend-button",3,"click"],[1,"product-img",3,"src"],[1,"initials-box"]],template:function(t,e){1&t&&(A.Pb(0,"ion-grid"),A.Pb(1,"ion-row",0),A.Pb(2,"ion-col",1),A.tc(3,S,1,1,"img",2),A.tc(4,T,2,1,"div",3),A.Ob(),A.Pb(5,"ion-col",4),A.Pb(6,"ion-text"),A.vc(7),A.Ob(),A.Ob(),A.Pb(8,"ion-col",5),A.Pb(9,"ion-button",6),A.Xb("click",(function(){return e.onClickRow(e.participation)})),A.vc(10),A.ac(11,"translate"),A.Ob(),A.Ob(),A.Ob(),A.Ob()),2&t&&(A.zb(3),A.hc("ngIf",e.getProfilePicUrl(e.participation)),A.zb(1),A.hc("ngIf",!e.getProfilePicUrl(e.participation)),A.zb(3),A.yc(" ",null==e.participation.member?null:e.participation.member.firstName," ",null==e.participation.member?null:e.participation.member.lastName," "),A.zb(3),A.xc(" ",A.bc(11,5,e.buttonText)," "))},directives:[R.w,R.P,R.q,D.o,R.bb,R.h],pipes:[B.c],styles:[".participants-list-row[_ngcontent-%COMP%]{display:flex;align-items:center}.attend-button[_ngcontent-%COMP%]{font-size:clamp(.5rem,3vw,.7rem);max-width:100%;white-space:inherit;word-wrap:break-word}.initials-box[_ngcontent-%COMP%]{width:100%;min-height:50px;max-height:100px;font-size:1.4rem;display:flex;align-items:center;justify-content:center;color:#377dff;background-color:rgba(55,125,255,.1)}.initials-box[_ngcontent-%COMP%], .product-img[_ngcontent-%COMP%]{border-radius:5px}"]}),Z),E=a("oVnf"),F=a("DVhg");function X(t,e){1&t&&(A.Pb(0,"div",5),A.Lb(1,"ion-spinner",6),A.Ob())}function K(t,e){1&t&&(A.Pb(0,"ion-row"),A.Pb(1,"ion-col"),A.Pb(2,"div",20),A.Lb(3,"ion-spinner"),A.Ob(),A.Ob(),A.Ob())}function J(t,e){if(1&t){var n=A.Qb();A.Pb(0,"ion-item"),A.Pb(1,"attendance-row",25),A.Xb("onAttendanceClicked",(function(t){return A.oc(n),A.Zb(3).onClickDidAttend(t)})),A.Ob(),A.Ob()}if(2&t){var i=e.$implicit;A.zb(1),A.hc("participation",i)}}function Q(t,e){if(1&t){var n=A.Qb();A.Pb(0,"ion-item"),A.Pb(1,"attendance-row",26),A.Xb("onAttendanceClicked",(function(t){return A.oc(n),A.Zb(3).onClickDidNotAttend(t)})),A.Ob(),A.Ob()}if(2&t){var i=e.$implicit;A.zb(1),A.hc("participation",i)("buttonText","bookingModule.cancelAttendance")}}function U(t,e){if(1&t&&(A.Pb(0,"div",21),A.Pb(1,"ion-list",22),A.ac(2,"async"),A.Pb(3,"ion-list-header"),A.Pb(4,"h4"),A.vc(5),A.ac(6,"translate"),A.Ob(),A.Ob(),A.tc(7,J,2,1,"ion-item",23),A.ac(8,"async"),A.Ob(),A.Pb(9,"ion-list",24),A.ac(10,"async"),A.Pb(11,"ion-list-header"),A.Pb(12,"h4"),A.vc(13),A.ac(14,"translate"),A.Ob(),A.Ob(),A.tc(15,Q,2,2,"ion-item",23),A.ac(16,"async"),A.Ob(),A.Ob()),2&t){var n=A.Zb(2);A.zb(1),A.hc("hidden",0===A.bc(2,6,n.unattendingParticipations$).length),A.zb(4),A.wc(A.bc(6,8,"general.pending")),A.zb(2),A.hc("ngForOf",A.bc(8,10,n.unattendingParticipations$)),A.zb(2),A.hc("hidden",0===A.bc(10,12,n.attendingParticipations$).length),A.zb(4),A.wc(A.bc(14,14,"bookingModule.attending")),A.zb(2),A.hc("ngForOf",A.bc(16,16,n.attendingParticipations$))}}function _(t,e){if(1&t){var n=A.Qb();A.Pb(0,"div",7),A.Pb(1,"ion-refresher",8),A.Xb("ionRefresh",(function(t){return A.oc(n),A.Zb().doRefresh(t)})),A.Lb(2,"ion-refresher-content"),A.Ob(),A.Pb(3,"ion-row"),A.Pb(4,"ion-col",9),A.Pb(5,"h4",10),A.vc(6),A.ac(7,"stripHtmlTags"),A.ac(8,"async"),A.ac(9,"getTranslation"),A.ac(10,"async"),A.Ob(),A.Ob(),A.Pb(11,"ion-col",11),A.Pb(12,"ion-button",12),A.Xb("click",(function(){return A.oc(n),A.Zb().onClickAllDidAttend()})),A.vc(13),A.ac(14,"translate"),A.Ob(),A.Ob(),A.Ob(),A.tc(15,K,4,0,"ion-row",13),A.ac(16,"async"),A.tc(17,U,17,18,"div",14),A.ac(18,"async"),A.Pb(19,"ion-card"),A.Pb(20,"ion-card-header"),A.Pb(21,"ion-card-title"),A.Pb(22,"h4"),A.vc(23),A.ac(24,"translate"),A.Ob(),A.Ob(),A.Ob(),A.Pb(25,"ion-card-content"),A.Pb(26,"form",15),A.Xb("ngSubmit",(function(){return A.oc(n),A.Zb().onSubmitForm()})),A.Pb(27,"ion-row",16),A.Pb(28,"ion-col",17),A.Pb(29,"ion-item"),A.Lb(30,"ion-input",18),A.Ob(),A.Ob(),A.Pb(31,"ion-col",17),A.Pb(32,"ion-button",19),A.vc(33),A.ac(34,"translate"),A.Ob(),A.Ob(),A.Ob(),A.Ob(),A.Ob(),A.Ob(),A.Ob()}if(2&t){var i,o=e.ngIf,a=A.Zb();A.zb(6),A.xc(" ",A.bc(7,9,A.bc(8,11,A.dc(9,13,null==(i=A.bc(10,17,a.booking$))?null:i.linkedProductId,"product","description")))," "),A.zb(7),A.xc(" ",A.bc(14,19,"bookingModule.allDidAttend")," "),A.zb(2),A.hc("ngIf",A.bc(16,21,a.isLoading$)&&!a.isRefreshing),A.zb(2),A.hc("ngIf",!A.bc(18,23,a.isLoading$)),A.zb(6),A.wc(A.bc(24,25,"bookingModule.totalMembersOnline")),A.zb(3),A.hc("formGroup",a.form)("patchForm",o),A.zb(6),A.hc("disabled",!a.form.valid),A.zb(1),A.xc(" ",A.bc(34,27,"general.submit")," ")}}var H,V,G,Y=[{path:"",component:(H=function(){function e(t,i,o,a,r,c){n(this,e),this.store=t,this.fb=i,this.notificationService=o,this.translate=a,this.sanitizer=r,this.actions$=c,this.isRefreshing=!1}return o(e,[{key:"ionViewDidEnter",value:function(){var t=this;this.store.dispatch(C.a.resetState()),this.isLoading$=this.store.select(x.a.selectIsLoading).pipe(Object(l.a)(!1)),this.bookingIdParam$=this.store.select(j.a.selectIdRouteParam),this.booking$=this.bookingIdParam$.pipe(Object(d.a)((function(t){return Boolean(t)})),Object(u.a)((function(e){t.store.dispatch(z.a.fetchOneById({id:e})),t.store.dispatch(C.a.fetchManyByBookingId({bookingId:e,params:P.RequestQueryBuilder.create({join:[{field:"member"},{field:"member.picture"},{field:"member.documents"}]})}))})),Object(f.a)((function(e){return t.store.select(j.a.selectById,e)}))),this.bookingParticipations$=this.bookingIdParam$.pipe(Object(f.a)((function(e){return t.store.select(x.a.selectByFilter,{field:"bookingId",value:e})}))),this.unattendingParticipations$=this.bookingParticipations$.pipe(Object(p.a)((function(t){return t.filter((function(t){return!t.attended})).sort((function(t,e){var n,i,o,a,r="".concat(null===(n=null==t?void 0:t.member)||void 0===n?void 0:n.firstName," ").concat(null===(i=null==t?void 0:t.member)||void 0===i?void 0:i.lastName).toLowerCase(),c="".concat(null===(o=null==e?void 0:e.member)||void 0===o?void 0:o.firstName," ").concat(null===(a=null==e?void 0:e.member)||void 0===a?void 0:a.lastName).toLowerCase();return null==r?void 0:r.localeCompare(c)}))}))),this.attendingParticipations$=this.bookingParticipations$.pipe(Object(p.a)((function(t){return t.filter((function(t){return t.attended})).sort((function(t,e){var n,i,o,a,r="".concat(null===(n=null==t?void 0:t.member)||void 0===n?void 0:n.firstName," ").concat(null===(i=null==t?void 0:t.member)||void 0===i?void 0:i.lastName).toLowerCase(),c="".concat(null===(o=null==e?void 0:e.member)||void 0===o?void 0:o.firstName," ").concat(null===(a=null==e?void 0:e.member)||void 0===a?void 0:a.lastName).toLowerCase();return null==r?void 0:r.localeCompare(c)}))})))}},{key:"ngOnInit",value:function(){this.form=this.fb.group({totalMembersOnline:["",[y.r.required]]})}},{key:"onClickDidAttend",value:function(t){var e=this;this.translate.get("bookingModule.attending").pipe(Object(m.a)(1)).subscribe((function(n){e.notificationService.emit("".concat(n," - ").concat(t.member.firstName," ").concat(t.member.lastName),"primary")})),this.store.dispatch(w.a({taskRequest:{type:I.a.accessControlRequestEntryByBooking,isAsync:!1,params:{bookingId:t.bookingId,memberId:t.memberId}}})),this.actions$.pipe(Object(k.d)(w.e),Object(h.a)(5e3),Object(g.a)((function(t){return Object(b.a)(null)}))).subscribe((function(n){n&&e.store.dispatch(C.a.fetchOneById({id:t.id,params:P.RequestQueryBuilder.create({join:[{field:"member"},{field:"member.picture"},{field:"member.documents"}]})}))})),this.bookingIdParam$.pipe(Object(f.a)((function(t){return e.store.select(j.a.selectById,t)})),Object(m.a)(1)).subscribe((function(t){t.attendenceCheckedBy||e.store.select(O.a.selectMember).pipe(Object(m.a)(1)).subscribe((function(n){e.store.dispatch(z.a.updateOneById({id:t.id,params:{attendenceCheckedBy:+n.id,startDate:s(t.startDate),endDate:s(t.endDate)}}))}))}))}},{key:"onClickAllDidAttend",value:function(){var t=this;return this.unattendingParticipations$.pipe(Object(m.a)(1)).subscribe((function(e){return e.forEach((function(e,n){setTimeout((function(){return t.onClickDidAttend(e)}),1500*n)}))}))}},{key:"onClickDidNotAttend",value:function(t){return this.store.dispatch(C.a.updateOneById({id:t.id,params:Object.assign(Object.assign({},t),{attended:!1})}))}},{key:"onSubmitForm",value:function(){var e=this;this.bookingIdParam$.pipe(Object(f.a)((function(t){return e.store.select(j.a.selectById,t)})),Object(v.a)(this.store.select(O.a.selectMember)),Object(m.a)(1)).subscribe((function(n){var i=t(n,2),o=i[0],a=i[1];e.store.dispatch(z.a.updateOneById({id:o.id,params:{totalMembersOnline:e.form.controls.totalMembersOnline.value,attendenceCheckedBy:a.id,startDate:s(o.startDate),endDate:s(o.endDate)}}))}))}},{key:"doRefresh",value:function(t){var e=this;this.isRefreshing=!0,this.store.dispatch(C.a.resetState()),this.booking$.pipe(Object(m.a)(1)).subscribe((function(t){e.store.dispatch(C.a.fetchManyByBookingId({bookingId:t.id,params:P.RequestQueryBuilder.create({join:[{field:"member"},{field:"member.picture"},{field:"member.documents"}]})}))})),this.actions$.pipe(Object(k.d)(C.a.upsertMany),Object(h.a)(5e3),Object(g.a)((function(n){return t.target.complete(),e.isRefreshing=!1,Object(b.a)(null)}))).subscribe((function(n){e.isRefreshing=!1,t.target.complete()}))}},{key:"ngOnDestroy",value:function(){}}]),e}(),H.\u0275fac=function(t){return new(t||H)(A.Kb($.h),A.Kb(y.c),A.Kb(M.a),A.Kb(B.d),A.Kb(N.b),A.Kb(k.a))},H.\u0275cmp=A.Eb({type:H,selectors:[["booking-attendence"]],decls:13,vars:13,consts:[["slot","start"],["defaultHref","/home/myhome/index/my-classes",3,"text"],[3,"fullscreen"],["class","ion-padding",4,"ngIf"],["class","main-content",4,"ngIf"],[1,"ion-padding"],[1,"ion-margin-horizontal"],[1,"main-content"],["slot","fixed",3,"ionRefresh"],["size","7"],[1,"ion-margin-start"],["size","5"],["color","primary","size","small",1,"ion-margin-top","ion-margin-end","all-did-attend-button","item-text-wrap",3,"click"],[4,"ngIf"],["class","list-container",4,"ngIf"],[3,"formGroup","patchForm","ngSubmit"],[1,"ion-margin-top"],["size","6"],["formControlName","totalMembersOnline","type","number","placeholder","0"],["expand","block","type","submit",3,"disabled"],[1,"ion-text-center"],[1,"list-container"],[3,"hidden"],[4,"ngFor","ngForOf"],[1,"ion-margin-top",3,"hidden"],[2,"width","100%",3,"participation","onAttendanceClicked"],[2,"width","100%",3,"participation","buttonText","onAttendanceClicked"]],template:function(t,e){1&t&&(A.Pb(0,"ion-header"),A.Pb(1,"ion-toolbar"),A.Pb(2,"ion-buttons",0),A.Lb(3,"ion-back-button",1),A.Ob(),A.Pb(4,"ion-title"),A.vc(5),A.ac(6,"translate"),A.Ob(),A.Ob(),A.Ob(),A.Pb(7,"ion-content",2),A.tc(8,X,2,0,"div",3),A.ac(9,"async"),A.ac(10,"async"),A.tc(11,_,35,29,"div",4),A.ac(12,"async"),A.Ob()),2&t&&(A.zb(3),A.hc("text",""),A.zb(2),A.xc(" ",A.bc(6,5,"bookingModule.attendence")," "),A.zb(2),A.hc("fullscreen",!0),A.zb(1),A.hc("ngIf",!A.bc(9,7,e.booking$)||A.bc(10,9,e.isLoading$)),A.zb(3),A.hc("ngIf",A.bc(12,11,e.booking$)))},directives:[R.x,R.gb,R.i,R.e,R.f,R.eb,R.r,D.o,R.X,R.M,R.N,R.P,R.q,R.h,R.j,R.l,R.n,R.k,y.s,y.n,y.g,L.a,R.D,R.C,R.mb,y.m,y.e,R.H,R.I,D.n,q],pipes:[B.c,D.b,E.a,F.a],styles:[".all-did-attend-button[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;white-space:inherit}"]}),H)}],W=((G=o((function t(){n(this,t)}))).\u0275mod=A.Ib({type:G}),G.\u0275inj=A.Hb({factory:function(t){return new(t||G)},imports:[[c.m.forChild(Y)],c.m]}),G),tt=((V=o((function t(){n(this,t)}))).\u0275mod=A.Ib({type:V}),V.\u0275inj=A.Hb({factory:function(t){return new(t||V)},providers:[],imports:[[W,r.a]]}),V)}}])}();